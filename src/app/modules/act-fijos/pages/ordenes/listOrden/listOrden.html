<div class="">
  <div class="p-1">
    <div class="row animated fadeIn fast">
      <div class="col-md-12">
       <!--  <div class="card bg-body rounded">
          <div class="card-body">
            <div class="accordion" id="accordionPanelsStayOpenExample">
              <div class="accordion-item">
                <h2 class="accordion-header">
                  <button class="accordion-button btnAccordion" type="button" data-bs-toggle="collapse"
                    data-bs-target="#panelsStayOpen-collapseOne" aria-expanded="true"
                    aria-controls="panelsStayOpen-collapseOne">
                    Filtrar Búsqueda - Monto Total en Gastos &nbsp;
                    <b> {{ gastos.montoTotalGasto | number : "1.2-2" : "es-ES" }}
                      Bs.- </b>
                    &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
                    <span>Encargado: &nbsp; </span>
                    <span><b>{{ encargado}}</b> </span>
                  </button>
                </h2>
                <div id="panelsStayOpen-collapseOne" class="accordion-collapse collapse show"
                  aria-labelledby="panelsStayOpen-headingOne">
                  <div class="accordion-body">
                    <form [formGroup]="searchForm">
                      <div class="row form-smaller">
                        <div class="col-auto">
                          <span class=""><b>Tipo de Gasto</b></span>
                          <div class="input-group input-group-sm">
                            <ngx-select [allowClear]="true" [items]="gastoFondos" optionTextField="denominacion"
                              optionValueField="denominacion" placeholder="Seleccione tipo de gasto"
                              formControlName="tipoGasto">
                              <ng-template ngx-select-option ngx-select-option-selected let-option let-text="text">
                                <span [innerHtml]="text"></span>
                              </ng-template>
                            </ngx-select>
                          </div>
                        </div>

                        <div class="col-auto">
                          <span class=""><b>Tipo de Fondo</b></span>
                          <div class="input-group input-group-sm">
                            <ngx-select [allowClear]="true" [items]="tipoFondos" optionTextField="denominacion"
                              optionValueField="denominacion" placeholder="Seleccione Tipo de Fondo"
                              formControlName="tipoFondo" (select)="doSelect($event)">
                              <ng-template ngx-select-option ngx-select-option-selected let-option let-text="text">
                                <span [innerHtml]="text"></span>
                              </ng-template>
                            </ngx-select>
                          </div>
                        </div>

                        <div class="col-auto" *ngIf="descargos.length > 0">
                          <span class=""><b>Número Descargo</b></span>
                          <div class="input-group input-group-sm">
                            <ngx-select [allowClear]="true" [items]="descargos" optionTextField="numDescargo"
                              optionValueField="numDescargo" placeholder="Seleccione N° Descargo"
                              formControlName="numDescargo" (select)="doSelect1($event)">
                              <ng-template ngx-select-option ngx-select-option-selected let-option let-text="text">
                                <span [innerHtml]="text"></span>
                              </ng-template>
                            </ngx-select>
                          </div>
                        </div>

                        <div class="col-auto">
                          <span class=""><b>Estado</b></span>
                          <div class="input-group input-group-sm" style="width: 160px">
                            <select formControlName="estado" class="form-select">
                              <option value="" [defaultSelected]="true">
                                Seleccione Estado
                              </option>
                              <option value="EJECUTADO">EJECUTADO</option>
                              <option value="EN ESPERA">EN ESPERA</option>
                              <option value="PENDIENTE">PENDIENTE</option>
                              <option value="DESCARGO">DESCARGO</option>
                            </select>
                          </div>
                        </div>

                        <div class="col-md-1">
                          <span class="" id="deFecha"><b>Fecha Inicio</b></span>
                          <div class="input-group input-group-sm">
                            <input style="width: 100px" class="form-control" type="date" formControlName="deFecha" />
                          </div>
                        </div>

                        <div class="col-md-1">
                          <span class="" id="alFecha"><b>Fecha Fin</b></span>
                          <div class="input-group input-group-sm">
                            <input style="width: 100px" class="form-control" type="date" formControlName="alFecha" />
                          </div>
                        </div>
                        <div class="col-auto">
                          <button (click)="busquedaAvanzada()" class="btn btn-primary" [disabled]="searchForm.invalid"
                            style="
                              --bs-btn-padding-y: 0.25rem;
                              --bs-btn-font-size: 0.75rem;
                            ">
                            Busqueda Avanzada
                          </button>
                        </div>
                        <div class="col-auto">
                          <button (click)="cargarGastos(searchForm.value)" class="btn btn-success"
                            [disabled]="searchForm.invalid" style="
                              --bs-btn-padding-y: 0.25rem;
                              --bs-btn-font-size: 0.75rem;
                            ">
                            Buscar
                          </button>
                        </div>
                        <div class="col-auto">
                          <button (click)="resetFormSearch()" class="btn btn-info" [disabled]="searchForm.invalid"
                            style="
                              --bs-btn-padding-y: 0.25rem;
                              --bs-btn-font-size: 0.75rem;
                            ">
                            Limpiar
                          </button>
                        </div>
                        <div class="col-auto center text-center">
                          <a class="fas fa-file-pdf icono iconoRed" (click)="printGasto(searchForm.value)"
                            title="Vista Previa"><br>
                            <p>Vista Previa</p>
                          </a>
                        </div>
                        <div class="col-auto" *ngIf="searchForm.value.estado === 'EJECUTADO'">
                          <button type="button" class="btn btn-primary btn-sm" data-bs-toggle="modal"
                            data-bs-target="#medida" style="
                              --bs-btn-padding-y: 0.25rem;
                              --bs-btn-font-size: 0.75rem;
                            ">
                            Generar Descargo
                          </button>
                        </div>

                  
                      </div>
                      <div class="row form-smaller" *ngIf="busquedaAvanzadaVisible">
                        <div class="col-auto">
                          <span class=""><b>Categoría Programática</b></span>
                          <div class="input-group input-group-sm">
                            <ngx-select [allowClear]="true" [items]="catProgras" optionTextField="codigo"
                              optionValueField="cat_programatica" placeholder="Seleccione Categoría Programatica"
                              formControlName="catProgra">
                              <ng-template ngx-select-option ngx-select-option-selected let-option let-text="text">
                                <span [innerHtml]="text"></span>
                                &nbsp;({{ option.data.proyect_acti }})
                              </ng-template>
                            </ngx-select>
                          </div>
                        </div>

                        <div class="col-auto">
                          <span class=""><b>FF-OF</b></span>
                          <div class="input-group input-group-sm">
                            <ngx-select [allowClear]="true" [items]="fuentes" optionTextField="ffof"
                              optionValueField="ffof" placeholder="Seleccione FF-OF" formControlName="fuente">
                              <ng-template ngx-select-option ngx-select-option-selected let-option let-text="text">
                                <span [innerHtml]="text"></span>
                                &nbsp;{{ option.data.denominacion }}
                              </ng-template>
                            </ngx-select>
                          </div>
                        </div>

                        <div class="col-auto">
                          <span class=""><b>Partida de Gasto</b></span>
                          <div class="input-group input-group-sm">
                            <ngx-select class="sel" [allowClear]="true" [items]="partidas" optionTextField="codigo"
                              optionValueField="codigo" placeholder="Seleccione Partida de Gasto"
                              formControlName="partida">
                              <ng-template ngx-select-option ngx-select-option-selected let-option let-text="text">
                                <span [innerHtml]="text"></span>
                                &nbsp;- {{ option.data.denominacion }}
                              </ng-template>
                            </ngx-select>
                          </div>
                        </div>

                        <div class="col-auto">
                          <span class=""><b>Encargado</b></span>
                          <div class="input-group input-group-sm">
                            <ngx-select class="sel" [allowClear]="true" [items]="funcionarios"
                              optionTextField="username" optionValueField="_id" placeholder="Seleccione Encargado"
                              formControlName="solicitante" (select)="doSelect2($event)">
                              <ng-template ngx-select-option ngx-select-option-selected let-option let-text="text">
                                <span [innerHtml]="text"></span>
                                &nbsp;{{ option.data.surnames }}
                              </ng-template>
                            </ngx-select>
                          </div>
                        </div>
                      </div>
                    </form>
                  </div>
                </div>
              </div>
              <div class="accordion-item">
                <h2 class="accordion-header" id="panelsStayOpen-headingTwo">
                  <button class="accordion-button collapsed btnAccordion" type="button" data-bs-toggle="collapse"
                    data-bs-target="#panelsStayOpen-collapseTwo" aria-expanded="false"
                    aria-controls="panelsStayOpen-collapseTwo">
                    Resumen por Fuente de Financiamiento - Organismo Financiador
                  </button>
                </h2>
                <div id="panelsStayOpen-collapseTwo" class="accordion-collapse collapse"
                  aria-labelledby="panelsStayOpen-headingTwo">
                  <div class="accordion-body">
                    <div class="row">
                      <div class="col-md-3">
                        <h3 class="card-title" style="color: #003d75">
                          Monto Total en Gastos
                          {{
                          gastos.montoTotalGasto | number : "1.2-2" : "es-ES"
                          }}
                          Bs.-
                        </h3>
                      </div>
                      <div class="col-md-2">
                        <div class="card shadow">
                          <div class="card-body">
                            <table class="table table-hover m-0">
                              <thead>
                                <tr>
                                  <th>N°</th>
                                  <th>FF-OF</th>
                                  <th>Monto</th>
                                </tr>
                              </thead>
                              <tbody class="table-group-divider">
                                <tr *ngFor="
                                    let fuente of gastos.resumenPorFuente;
                                    let i = index
                                  ">
                                  <td>{{ i + 1 }}</td>
                                  <td>{{ fuente._id }}</td>
                                  <td>
                                    {{
                                    fuente.totalMonto
                                    | number : "1.2-2" : "es-ES"
                                    }}
                                  </td>
                                </tr>
                              </tbody>
                            </table>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="accordion-item">
                <h2 class="accordion-header" id="panelsStayOpen-headingThree">
                  <button class="accordion-button collapsed btnAccordion" type="button" data-bs-toggle="collapse"
                    data-bs-target="#panelsStayOpen-collapseThree" aria-expanded="false"
                    aria-controls="panelsStayOpen-collapseThree">
                    Imprimir Reportes
                  </button>
                </h2>
                <div id="panelsStayOpen-collapseThree" class="accordion-collapse collapse"
                  aria-labelledby="panelsStayOpen-headingThree">
                  <div class="accordion-body">report</div>
                </div>
              </div>
            </div>
          </div>
        </div> -->
      </div>
    </div>
    <!--  {{ searchForm.value | json }} -->
    <div class="row animated fadeIn fast" *ngIf="cargando">
      <div class="col-md-12">
        <div class="alert alert-info text-center">
          <h4 class="alert-heading">Cargando</h4>
          <i class="fas fa-sync-alt fa-spin"></i><br />
          <span>Por favor espere</span>
        </div>
      </div>
    </div>
    <div class="row animated fadeIn fast" *ngIf="!cargando">
      <div class="col-md-12">
        <div class="card shadow">
          <div class="card-body">
            <table class="table table-hover mb-2">
              <thead>
                <tr style="text-align: center">
                  <th>N°</th>
                  <th>N° de Orden</th>
                  <th>Fecha</th>
                  <th>Ap. Programatica</th>
                  <th>Glosa</th>
                  <th>Unidad Solicitante</th>
                  <th>Encargado</th>
                  <th>Conductor</th>
                  <th>Vehiculo</th>
                  <th>Fecha Entrada</th>
                  <th>Fecha Salida:</th>
                  <th>Monto</th>
                  <th>N° de Vale</th>
                  <th>Estado</th>
                  <th>Acciones</th>
                </tr>
              </thead>
              <tbody class="table-group-divider">
                <tr *ngFor="let orden of ordenes; let i = index">
                  <td>{{ i + 1 }}</td>
                  <td>{{ orden.numeroOrden ?? "" }}</td>
                  <td>
                    {{ orden.fecha | date : "mediumDate" : "UTC" }}
                  </td>
                  <td style="text-align: center">{{ orden.catProgra }}</td>
                  <td>{{ orden.descripcion }}</td>
                  <td>{{ orden.unidadSolicitante?.nombresubdir ?? "No Asignado" }}</td>
                  <td style="text-align: center">{{ orden.encargadoControl.username }} {{ orden.encargadoControl.surnames }}</td>
                  <td style="text-align: center">{{ orden.conductor.username }} {{ orden.conductor.surnames }}</td>
                  <td style="text-align: center">{{ orden.vehiculo.tipo }} {{ orden.vehiculo.placa }}</td>
                   <td>
                    {{ orden.fechaEntrada | date : "mediumDate" : "UTC" }}
                  </td>
                   <td>
                    {{ orden.fechaSalida | date : "mediumDate" : "UTC" }}
                  </td>
                  <td style="text-align: right">
                    {{ orden.precio | number : "1.2-2" : "es-ES" }}
                  </td>
                  <td style="text-align: center">
                    {{ orden.idCombustible?.numeroVale ?? "" }}
                  </td>

                  <td style="text-align: center">
                    <span class="textEstado" [ngSwitch]="orden.estado">
                      <span *ngSwitchCase="'REGISTRADO'" class="badge badge-danger" title="Cambiar Estado">{{
                        orden.estado }}
                      </span>
                      <span *ngSwitchCase="'EJECUTADO'" class="badge badge-info">{{ orden.estado }}</span>
                      <span *ngSwitchCase="'DESCARGO'" class="badge badge-success">{{ orden.estado }}</span>
                      <span *ngSwitchCase="'EN ESPERA'" class="badge badge-warning">{{ orden.estado }}</span>
                    </span>
                  </td>
                  <td>
                     <i
                      class="fas fa-file-pdf ml-2 icono iconoRed"
                      title="Imprimir"
                      data-bs-toggle="modal"
                      data-bs-target="#imprimir"
                      (click)="printOrden(orden._id)"
                    ></i>
                    <!-- <input *ngIf="
                        gasto.estado === 'EJECUTADO' ||
                        gasto.estado === 'EN ESPERA'
                      " class="form-check-input pointer" type="checkbox" role="switch"
                      [checked]="gasto.estado === 'EJECUTADO'" id="{{ 'toggle' + i }}" (change)="
                        changeStatus(
                          gasto._id,
                          !(gasto.estado === 'EJECUTADO'),
                          gasto
                        )
                      " title="En Espera/Ejecutado" /> -->
                    <span *ngIf="orden.estado !== 'EJECUTADO'">
                      <i class="fas fa-file-export ml-2 icono iconoSkyBlue" (click)="edit(orden._id)" title="Generar Gasto"></i>
                    </span>
                     <!--  <span *ngIf="gasto.estado !== 'DESCARGO' || gasto.tipoGasto !== 'Combustible'">
                      <i class="fas fa-plus-square ml-2 icono"  data-bs-toggle="modal"
                      data-bs-target="#modalAddFactura" (click)="cargarDataGasto(gasto)" title="Agregar Factura"></i>
                    </span> -->
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>


<!-- Modal Imprimir -->
<div
  class="modal fade"
  id="imprimir"
  tabindex="-1"
  aria-labelledby="imprimirLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-xl">
    <!-- Tamaño grande para el PDF -->
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="imprimirLabel">Vista previa del PDF</h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Cerrar"
        ></button>
      </div>
      <div class="modal-body" style="height: 80vh">
        <iframe
          [src]="pdfUrl | safe : 'resourceUrl'"
          width="100%"
          height="100%"
          frameborder="0"
        ></iframe>
      </div>
    </div>
  </div>
</div>

<!-- Modal Agregar factura -->
<!-- 
<div
  class="modal fade"
  id="modalAddFactura"
  data-bs-backdrop="static"
  data-bs-keyboard="false"
  tabindex="-1"
  aria-labelledby="modalEditLabel"
  aria-hidden="true"
>
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="modalEditLabel">
          Agregar Factura al Gasto
        </h1>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <form (ngSubmit)="addFactura(addFactForm.value)" [formGroup]="addFactForm">
          <div class="mb-1">
            <label for="numeroFactura" class="form-label">Número de la factura:</label>
            <input
              id="numeroFactura"
              class="form-control"
              type="number"
              formControlName="numeroFactura"
            />
          </div>

          <div>
            <label for="montoFactura" class="form-label">Monto de la factura:</label>
             <input
              id="montoFactura"
              class="form-control"
              type="number"
              formControlName="montoFactura"
            />
          </div>

          <div class="mb-1">
            <label for="fechaFactura" class="form-label">Fecha de la factura:</label>
            <input
              id="fechaFactura"
              class="form-control"
              type="date"
              formControlName="fechaFactura"
            />
          </div>

          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
              (click)="resetForm()"
            >
              Cancelar
            </button>
            <button
              type="submit"
              class="btn btn-primary"
              data-bs-dismiss="modal"
            >
              Agregar
            </button>
          </div>
             {{ addFactForm.value | json }}
        </form>
      </div>
    </div>
  </div>
</div> -->


